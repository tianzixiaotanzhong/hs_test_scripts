# 雷赛L7伺服驱动器测试工具集（精简版）

## 项目结构

```
leisai_test/
├── leisai_l7_driver/       # 驱动器核心库
│   ├── leisai/            # 主驱动模块
│   │   ├── core/          # 核心功能（驱动、运动、参数、监控）
│   │   └── protocols/     # 通信协议（Modbus RTU、串口）
│   └── docs/              # 技术文档
├── quick_test.py          # 快速测试脚本
├── pr_cli.py             # PR循环触发工具
└── README.md             # 本文档
```

## 功能特性

### 1. 快速测试工具 (quick_test.py)
- **连接测试**: 自动连接COM42端口
- **状态监控**: 显示电机位置、指令位置、速度、转矩、温度
- **位置信息**: 同时显示编码器单位和指令单位
- **交互测试**: 可选的JOG运动测试
- **自动断开**: 测试完成后自动断开连接

### 2. PR循环触发工具 (pr_cli.py)
- **循环触发**: 自动循环触发PR0→PR1→PR2
- **急停功能**: 按任意键立即急停并退出
- **简单连接**: 直接连接COM42端口
- **自动使能**: 自动尝试伺服使能

## 使用方法

### 安装依赖
```bash
pip install pyserial
```

### 运行工具

#### 1. 快速测试
```bash
python quick_test.py
```
显示内容：
- 电机位置（编码器单位）
- 指令位置（编码器单位）
- 电机位置（指令单位）
- 指令位置（指令单位）
- 速度、转矩、温度
- 伺服状态

#### 2. PR循环触发
```bash
python pr_cli.py
```
功能：
- 自动循环触发PR0→PR1→PR2
- 按任意键急停并退出
- 自动伺服使能

## 配置说明

### 修改串口
如需使用其他COM端口，请修改脚本中的端口设置：

**quick_test.py**:
```python
port = 'COM42'  # 修改为你的COM端口
```

**pr_cli.py**:
```python
port = 'COM42'  # 修改为你的COM端口
```

### 通信参数
- **波特率**: 38400
- **从站ID**: 1
- **超时时间**: 1.0秒

## 位置单位说明

### 编码器单位
- **电机位置**: 0x0B1C-0x0B1D (32位)
- **指令位置**: 0x0B1A-0x0B1B (32位)
- **分辨率**: 23位编码器 = 8,388,608 P/rev

### 指令单位
- **电机位置**: 0x0B16-0x0B17 (32位)
- **指令位置**: 0x0B14-0x0B15 (32位)
- **默认**: 10,000 P/rev

### 单位转换
```
指令单位 = 编码器单位 × 10000 ÷ 8388608
编码器单位 = 指令单位 × 8388608 ÷ 10000
```

## 注意事项

1. **安全第一**: 运行测试前确保设备处于安全状态
2. **端口占用**: 确保COM端口未被其他程序占用
3. **驱动器状态**: 确保驱动器电源已开启且无报警
4. **参数设置**: 确保驱动器参数设置正确

## 故障排除

### 连接失败
- 检查COM端口是否正确
- 确认驱动器电源已开启
- 验证通信参数（波特率、从站ID）
- 检查串口线连接

### 位置读取异常
- 确认编码器连接正常
- 检查驱动器参数设置
- 验证Modbus地址配置

### 温度读取异常
- 温度传感器可能未连接或故障
- 驱动器可能处于冷启动状态

## 技术支持

如遇到问题，请查看：
1. 控制台输出的错误信息
2. 雷赛L7驱动器使用手册
3. `leisai_l7_driver/docs/` 目录下的技术文档

## 版本历史

- **v2.0**: 精简版，保留核心功能
- **v1.0**: 完整测试套件版本